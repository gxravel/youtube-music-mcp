---
phase: 03-playlist-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/youtube/playlists.go
  - internal/server/tools_playlists.go
autonomous: true

must_haves:
  truths:
    - "Claude can create a new playlist on user's YouTube Music account with custom name, description, and privacy"
    - "Claude can add tracks to an existing playlist by video ID"
    - "Claude can list user's existing playlists to avoid duplicates (already implemented)"
    - "Created playlists appear immediately in user's YouTube Music interface"
  artifacts:
    - path: "internal/youtube/playlists.go"
      provides: "CreatePlaylist and AddVideosToPlaylist methods"
      contains: "func (c *Client) CreatePlaylist"
    - path: "internal/server/tools_playlists.go"
      provides: "create_playlist and add_to_playlist MCP tools"
      contains: "create_playlist"
  key_links:
    - from: "internal/server/tools_playlists.go"
      to: "internal/youtube/playlists.go"
      via: "s.ytClient.CreatePlaylist and s.ytClient.AddVideosToPlaylist calls"
      pattern: "s\\.ytClient\\.(CreatePlaylist|AddVideosToPlaylist)"
---

<objective>
Implement playlist creation and video addition capabilities so Claude can deliver music recommendations as playable YouTube Music playlists.

Purpose: This is the final phase — it completes the end-to-end flow: Claude reads taste data (Phase 2), searches for tracks (Phase 2), creates a playlist, and populates it with recommended tracks.
Output: Two new YouTube client methods (CreatePlaylist, AddVideosToPlaylist) and two new MCP tools (create_playlist, add_to_playlist).
</objective>

<execution_context>
@/home/gxravel/.claude/get-shit-done/workflows/execute-plan.md
@/home/gxravel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-playlist-management/03-RESEARCH.md
@internal/youtube/playlists.go
@internal/server/tools_playlists.go
@internal/server/server.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement CreatePlaylist and AddVideosToPlaylist YouTube client methods</name>
  <files>internal/youtube/playlists.go</files>
  <action>
Add two new methods to the YouTube client in `internal/youtube/playlists.go`:

**CreatePlaylist(ctx, title, description, privacyStatus) (*Playlist, error):**
- Validate title is non-empty (return error if blank)
- Default privacyStatus to "private" if empty
- Validate privacyStatus is one of: "public", "private", "unlisted" (return error otherwise)
- Call `c.service.Playlists.Insert([]string{"snippet", "status"}, playlist)` with a `youtube_v3.Playlist` containing `Snippet` (Title, Description) and `Status` (PrivacyStatus)
- Return domain `*Playlist` with ID, Title, Description, ItemCount=0
- Wrap errors with `fmt.Errorf("failed to create playlist: %w", err)`
- Quota cost: 50 units (document in comment)

**AddVideosToPlaylist(ctx, playlistID, videoIDs) (added int, error):**
- Validate playlistID non-empty and videoIDs non-empty slice
- Loop over videoIDs, for each:
  - Check `ctx.Err()` for cancellation
  - Create `youtube_v3.PlaylistItem` with `Snippet.PlaylistId` and `Snippet.ResourceId` (Kind: "youtube#video", VideoId)
  - Call `c.service.PlaylistItems.Insert([]string{"snippet"}, playlistItem)`
  - On error: use `errors.As(err, &apiErr)` to check for `*googleapi.Error`
    - If HTTP 409 or message contains "videoAlreadyInPlaylist": skip silently (continue)
    - Otherwise: return successCount and wrapped error
  - On success: increment successCount
- Return total successCount, nil
- Quota cost: 50 units per video (document in comment)
- Add necessary imports: `"errors"`, `"strings"`, `"google.golang.org/api/googleapi"`
  </action>
  <verify>Run `go build ./...` — must compile with no errors.</verify>
  <done>CreatePlaylist and AddVideosToPlaylist methods exist on youtube.Client, handle validation, API errors (including duplicate video skip), and return domain types.</done>
</task>

<task type="auto">
  <name>Task 2: Register create_playlist and add_to_playlist MCP tools</name>
  <files>internal/server/tools_playlists.go</files>
  <action>
Add two new MCP tools to the existing `registerPlaylistTools()` method in `internal/server/tools_playlists.go`, following the exact same pattern as existing tools (get_liked_videos, list_playlists, get_playlist_items):

**Tool: create_playlist**

Input struct `createPlaylistInput`:
- `Title string` — `json:"title" jsonschema:"required,description=Playlist name/title (required)"`
- `Description string` — `json:"description" jsonschema:"description=Playlist description (optional)"`
- `PrivacyStatus string` — `json:"privacyStatus" jsonschema:"description=Privacy setting: public\\, private\\, or unlisted (defaults to private),enum=public,enum=private,enum=unlisted"`

Output struct `createPlaylistOutput`:
- `PlaylistID string` — playlist ID
- `Title string` — playlist title
- `Description string` — playlist description
- `URL string` — `https://music.youtube.com/playlist?list={ID}`

Tool description: `"Create a new playlist on the user's YouTube Music account. Returns the playlist ID and a direct URL to open it in YouTube Music. Privacy defaults to 'private' if not specified. Quota cost: 50 units."`

Handler: call `s.ytClient.CreatePlaylist(ctx, input.Title, input.Description, input.PrivacyStatus)`, convert to output, return `mcp.CallToolResult` with text content `"Created playlist '{title}' (ID: {id})\nURL: {url}"`.

**Tool: add_to_playlist**

Input struct `addToPlaylistInput`:
- `PlaylistID string` — `json:"playlistId" jsonschema:"required,description=YouTube playlist ID (from create_playlist or list_playlists)"`
- `VideoIDs []string` — `json:"videoIds" jsonschema:"required,description=List of YouTube video IDs to add (from search_videos or get_video)"`

Output struct `addToPlaylistOutput`:
- `Added int` — number of videos successfully added
- `Total int` — total number of video IDs provided
- `PlaylistURL string` — direct URL to playlist

Tool description: `"Add one or more videos to an existing YouTube playlist by video ID. Duplicate videos are skipped silently. Use search_videos to find video IDs first. Quota cost: 50 units per video added."`

Handler: call `s.ytClient.AddVideosToPlaylist(ctx, input.PlaylistID, input.VideoIDs)`, return `mcp.CallToolResult` with text content `"Added {N} of {total} videos to playlist\nURL: {url}"`.
  </action>
  <verify>Run `go build ./...` — must compile with no errors. Run `go vet ./...` — must pass with no issues.</verify>
  <done>create_playlist and add_to_playlist tools are registered in the MCP server, with proper input validation via jsonschema tags, quota cost documentation in descriptions, and YouTube Music URLs in output.</done>
</task>

</tasks>

<verification>
1. `go build ./...` compiles successfully
2. `go vet ./...` passes with no issues
3. Two new methods exist on youtube.Client: CreatePlaylist, AddVideosToPlaylist
4. Two new MCP tools registered: create_playlist, add_to_playlist
5. Existing tools (get_liked_videos, list_playlists, get_playlist_items, search_videos, get_video, list_subscriptions) still compile and register
</verification>

<success_criteria>
- CreatePlaylist method creates a playlist via YouTube API with title, description, and privacy status
- AddVideosToPlaylist method adds videos to a playlist, skipping duplicates silently (409/videoAlreadyInPlaylist)
- create_playlist MCP tool exposes playlist creation to Claude with proper schema and quota documentation
- add_to_playlist MCP tool exposes video addition to Claude with batch support (array of video IDs)
- All code compiles and passes vet checks
</success_criteria>

<output>
After completion, create `.planning/phases/03-playlist-management/03-01-SUMMARY.md`
</output>
